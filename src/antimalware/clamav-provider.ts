import clamAv from 'clamav.js'
import * as configManager from '../config/config-manager'
import { AntimalwareClientType } from './antimalware-client'

export default class ClamAvProvider implements AntimalwareClientType {

    scanner: any

    constructor() {
        try {
            this.initializeClient()
        } catch (e) {
            throw e
        }
    }

    Scan(dataStream: any, handler: Function) {
        this.scanner.scan(dataStream, handler)
    }

    initializeClient() {
        try {
            const port = configManager.getClamAvPort()
            const endpoint = configManager.getClamEndPoint()
            this.scanner = clamAv.createScanner(port, endpoint)
        } catch (e) {
            throw e
        }
    }
}